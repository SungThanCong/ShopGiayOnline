@model ShopGiayOnline.Models.HOADON

@{
    ViewBag.Title = "ReviewOrder";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    .checked{
        color:orange;
    }
    span.fa.fa-star{
        font-size: 1.5em;
        cursor: pointer;
    }
    .plAxjc {
        resize: none;
        overflow: auto;
        min-height: 6.25rem;
        height: 100%;
        display: block;
        box-sizing: border-box;
        background-color: #fff;
        border-radius: 0.125rem;
        border: 1px solid rgba(0,0,0,.14);
        box-shadow: inset 0 2px 0 0 rgb(0 0 0 / 2%);
        color: #222;
        transition: border-color .1s ease;
        margin: auto auto 0.75rem;
        width: 100%;
        padding: 0.9375rem;
        font-size: .875rem;
        outline: 0;
    }
    .alert {
        padding: 20px;
        background-color: #f44336;
        color: white;
        position:fixed;
        right:12px;
        top:40px;
        width:500px;
        animation: anim-appear 0.5s; 
        
    }
    @@keyframes anim-appear{
        0%{
            right: -400px;
            opacity: 0;
        }
        100%{
            right: 12px;
            opacity: 1;
        }
    }

    .closebtn {
        margin-left: 15px;
        color: white;
        font-weight: bold;
        float: right;
        font-size: 22px;
        line-height: 20px;
        cursor: pointer;
        transition: 0.3s;
    }

    .closebtn:hover {
        color: black;
    }
</style>
<div class="container card mt-5 rounded-0 container-review">
    <div class="card-header">
        <h2>Review Order</h2>
    </div>
    <div class="card-body ">
        @foreach (var item in Model.CTHDs)
        {
        <div class="p-2 rounded-0 border border-3 border-start-0 border-end-0 ">
            <div class="d-flex justify-content-between mt-3">
                <div class="d-flex">
                    <img src="@Url.Content(item.GIAY.hinh ?? "~/Source/Default/giay_default.png")" width="100" height="100" class="p-1 me-3" />
                    <div>
                        <div class="fw-bold">@item.GIAY.tengiay</div>
                        <div style=" color:grey;">
                            <span>SIZE: </span>
                            <span class="item-cart-size">@item.size</span>
                        </div>
                    </div>
                </div>
                <div class="d-none shoe-id">@item.GIAY.magiay</div>
            </div>
            <div class="review-item text-center">
                <span class="fa fa-star star-1"></span>
                <span class="fa fa-star star-2"></span>
                <span class="fa fa-star star-3"></span>
                <span class="fa fa-star star-4"></span>
                <span class="fa fa-star star-5"></span>
            </div>
            <div class="mt-4">
                <textarea class="plAxjc" maxlength="300" placeholder="Share your experience with the product" 
                          spellcheck="false" style="overflow: hidden; overflow-wrap: break-word; height: 100px;"></textarea>
            </div>
        </div>
           
        }
    </div>
    <div class="card-footer p-3 text-end">
        <div>
            <a href="@Url.Action("Index","Order")" class="btn btn-dark opacity-75 rounded-0 me-2">BACK</a>
            <button onclick="ReviewHandle()" class="btn btn-danger rounded-0 float-end">CONFIRM</button>
        </div> 
    </div>
</div>

<div class="alert" style="display:none;">
    <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
    <strong>Failed!</strong> Please check all reivew star!
</div>
<div class="alert bg-success" style="display:none;">
    <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
    <strong>Successful!</strong> You can go back!
</div>

<script>
    const list_star_1 = document.getElementsByClassName("star-1");
    const list_star_2 = document.getElementsByClassName("star-2");
    const list_star_3 = document.getElementsByClassName("star-3");
    const list_star_4 = document.getElementsByClassName("star-4");
    const list_star_5 = document.getElementsByClassName("star-5");
    const list_review_item = document.getElementsByClassName("review-item");
    const con_alert = document.getElementsByClassName("alert")[0];
    const list_magiay = document.getElementsByClassName("shoe-id");
    const list_comment = document.getElementsByClassName("plAxjc");
    const container_review = document.getElementsByClassName("container-review")[0];

    Array.from(list_star_1).map((value, index) => {
        value.onclick = () => {
            list_review_item[index].classList.remove("enable");
            list_review_item[index].classList.add("enable");


            list_star_1[index].classList.remove("checked");
            list_star_2[index].classList.remove("checked");
            list_star_3[index].classList.remove("checked");
            list_star_4[index].classList.remove("checked");
            list_star_5[index].classList.remove("checked");

            list_star_1[index].classList.add("checked");
     
        }


    })

    Array.from(list_star_2).map((value, index) => {
        value.onclick = () => {
            list_review_item[index].classList.remove("enable");
            list_review_item[index].classList.add("enable");

            list_star_1[index].classList.remove("checked");
            list_star_2[index].classList.remove("checked");
            list_star_3[index].classList.remove("checked");
            list_star_4[index].classList.remove("checked");
            list_star_5[index].classList.remove("checked");

            list_star_1[index].classList.add("checked");
            list_star_2[index].classList.add("checked");
         
        }


    })

    Array.from(list_star_3).map((value, index) => {
        value.onclick = () => {
            list_review_item[index].classList.remove("enable");
            list_review_item[index].classList.add("enable");

            list_star_1[index].classList.remove("checked");
            list_star_2[index].classList.remove("checked");
            list_star_3[index].classList.remove("checked");
            list_star_4[index].classList.remove("checked");
            list_star_5[index].classList.remove("checked");

            list_star_1[index].classList.add("checked");
            list_star_2[index].classList.add("checked");
            list_star_3[index].classList.add("checked");
          
        }


    })

    Array.from(list_star_4).map((value, index) => {
        value.onclick = () => {
            list_review_item[index].classList.remove("enable");
            list_review_item[index].classList.add("enable");

            list_star_1[index].classList.remove("checked");
            list_star_2[index].classList.remove("checked");
            list_star_3[index].classList.remove("checked");
            list_star_4[index].classList.remove("checked");
            list_star_5[index].classList.remove("checked");

            list_star_1[index].classList.add("checked");
            list_star_2[index].classList.add("checked");
            list_star_3[index].classList.add("checked");
            list_star_4[index].classList.add("checked");
        }
        
  
    })

    Array.from(list_star_5).map((value, index) => {
        value.onclick = () => {
            list_review_item[index].classList.remove("enable");
            list_review_item[index].classList.add("enable");

            list_star_1[index].classList.remove("checked");
            list_star_2[index].classList.remove("checked");
            list_star_3[index].classList.remove("checked");
            list_star_4[index].classList.remove("checked");
            list_star_5[index].classList.remove("checked");

            list_star_1[index].classList.add("checked");
            list_star_2[index].classList.add("checked");
            list_star_3[index].classList.add("checked");
            list_star_4[index].classList.add("checked");
            list_star_5[index].classList.add("checked");
        }
    })

    function ReviewHandle() {
        let check = true;
        for (let i = 0; i < list_review_item.length; i++) {
            if (!list_review_item[i].classList.contains("enable")) {
                con_alert.style.display = 'block';
                check = false;
                break;
            }
        }
        if (check) {
            
            for (let i = 0; i < list_review_item.length; i++) {
                var magiay = list_magiay[i].textContent;
                var sosao = 0;
                if (list_star_5[i].classList.contains("checked")) {
                    sosao = 5;
                } else if (list_star_4[i].classList.contains("checked")) {
                    sosao = 4;
                } else if (list_star_3[i].classList.contains("checked")) {
                    sosao = 3;
                } else if (list_star_2[i].classList.contains("checked")) {
                    sosao = 2;
                } else if (list_star_1[i].classList.contains("checked")) {
                    sosao = 1;
                }
                var binhluan = list_comment[i].value;
                console.log(magiay + "\n" + sosao + "\n" + binhluan);
                if ($.post(`/Order/AddReview?magiay=${magiay}&sosao=${sosao}&binhluan=${binhluan}&sohd=${@Model.sohd}`)) {
                    document.getElementsByClassName("alert")[1].style.display = 'block';
                    
                };
            }
        }
    }
</script>


